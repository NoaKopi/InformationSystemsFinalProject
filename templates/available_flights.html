<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Available Flights | FLYTAU</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>

  {% include "topbar.html" %}

  <main class="hero">
    <section class="hero-card hero-card--wide">

      <h1>Available Flights</h1>
      <p class="subtitle">Results for your search</p>

      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="alert {{ category }}">{{ message }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      {# Show Business column only if at least one flight actually has business #}
      {% set show_business_col = flights and (flights|selectattr('has_business')|list|length > 0) %}

      <div class="table-card">
        <div class="table-header">
          <h3>Flights</h3>
        </div>

        <div class="table-wrap">
          <table class="flights-table">
            <thead>
              <tr>
                <th>Flight No.</th>
                <th>Origin</th>
                <th>Destination</th>
                <th>Date & Time</th>
                <th>Economy</th>
                {% if show_business_col %}
                  <th>Business</th>
                {% endif %}
                <th class="th-right">Action</th>
              </tr>
            </thead>

            <tbody>
              {% if flights and flights|length > 0 %}
                {% for flight in flights %}
                  <tr>
                    <td><span class="badge">#{{ flight.Flight_ID }}</span></td>

                    <td>
                      <div class="cell-title">{{ flight.origin_airport_name }}</div>
                      <div class="cell-sub">{{ flight.origin_city }}, {{ flight.origin_country }}</div>
                    </td>

                    <td>
                      <div class="cell-title">{{ flight.dest_airport_name }}</div>
                      <div class="cell-sub">{{ flight.dest_city }}, {{ flight.dest_country }}</div>
                    </td>

                    <td>
                      <div class="cell-title">{{ flight.Departure_Date }}</div>
                      <div class="cell-sub">{{ flight.Departure_Time }}</div>
                    </td>

                    <td><span class="price">${{ "%.2f"|format(flight.Economy_Price) }}</span></td>

                    {% if show_business_col %}
                      <td>
                        {% if flight.has_business %}
                          <span class="price">${{ "%.2f"|format(flight.Business_Price) }}</span>
                        {% else %}
                          <span style="color: rgba(11,27,43,.45); font-weight:800;">â€”</span>
                        {% endif %}
                      </td>
                    {% endif %}

                    <td class="td-right" style="display:flex; gap:10px; justify-content:flex-end;">
                      <a class="btn btn-secondary btn-small"
                         href="{{ url_for('book_flight', flight_id=flight.Flight_ID, class='Economy') }}">
                        Book Economy
                      </a>

                      {% if flight.has_business %}
                        <a class="btn btn-secondary btn-small"
                           href="{{ url_for('book_flight', flight_id=flight.Flight_ID, class='Business') }}">
                          Book Business
                        </a>
                      {% endif %}
                    </td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="{{ 7 if show_business_col else 6 }}" class="empty">
                    <div class="empty-title">No flights found</div>
                    <div class="empty-sub">Try changing the dates or destinations.</div>
                  </td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>

      <div class="cta-row cta-row--below">
        <a class="btn btn-secondary" href="{{ url_for('home_page') }}">Back to Search</a>
      </div>

    </section>
  </main>

</body>
</html>
