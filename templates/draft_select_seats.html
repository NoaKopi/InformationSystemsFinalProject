<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Select Seats | FLYTAU</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

  <style>
    /* ====== Layout wrapper ====== */
    .seatmap-shell{
      margin-top: 14px;
      padding: 18px;
      border-radius: 22px;
      border: 1px solid rgba(11,27,43,.12);
      background: rgba(255,255,255,.78);
      box-shadow: 0 12px 30px rgba(11,27,43,.09);
    }

    .seatmap-top{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:14px;
      margin-bottom: 12px;
    }

    .seatmap-top h3{ margin:0; }

    .legend{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      font-size: 13px;
      color: rgba(11,27,43,.7);
      font-weight: 800;
    }
    .lg{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(11,27,43,.10);
      background: rgba(255,255,255,.65);
    }
    .swatch{
      width:12px;height:12px;border-radius:999px;border:1px solid rgba(11,27,43,.18);
      box-shadow: 0 3px 10px rgba(11,27,43,.08);
    }
    .swatch.free{ background: rgba(26,163,255,.18); }
    .swatch.sel{ background: rgba(26,163,255,.92); }
    .swatch.lock{ background: rgba(11,27,43,.18); }

    /* ====== Plane body ====== */
    .plane{
      position: relative;
      padding: 18px 16px 14px;
      border-radius: 28px;
      background: linear-gradient(180deg, rgba(245,250,255,.95), rgba(255,255,255,.75));
      border: 1px solid rgba(11,27,43,.10);
      overflow: hidden;
    }

    /* subtle “fuselage” lines */
    .plane:before, .plane:after{
      content:"";
      position:absolute;
      left:-40px; right:-40px;
      height: 1px;
      background: rgba(11,27,43,.08);
      top: 58px;
      transform: rotate(-1deg);
    }
    .plane:after{
      top: auto;
      bottom: 54px;
      transform: rotate(1deg);
    }

    /* ====== Column letters header ====== */
    .cols{
      display:grid;
      grid-template-columns: 52px 52px 52px 46px 52px 52px;
      gap:12px;
      align-items:center;
      padding: 0 8px 10px;
      margin-bottom: 6px;
      color: rgba(11,27,43,.72);
      font-weight: 900;
      letter-spacing: .6px;
      text-transform: uppercase;
      font-size: 13px;
    }
    .cols .spacer{ visibility:hidden; }
    .cols .aisle-head{
      text-align:center;
      font-weight: 900;
      color: rgba(11,27,43,.45);
    }

    /* ====== Rows ====== */
    .rows{
      display:flex;
      flex-direction:column;
      gap:10px;
      padding: 0 8px;
    }

    .row{
      display:grid;
      grid-template-columns: 42px 52px 52px 46px 52px 52px;
      gap:12px;
      align-items:center;
      padding: 6px 6px;
      border-radius: 16px;
    }

    .row-num{
      text-align:right;
      padding-right: 6px;
      font-weight: 950;
      color: rgba(11,27,43,.72);
    }

    .aisle{
      height: 52px;
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(11,27,43,.05), rgba(11,27,43,.02));
      border: 1px dashed rgba(11,27,43,.12);
    }

    /* ====== Seat (SVG button) ====== */
    .seat{
      display:block;
      cursor:pointer;
      user-select:none;
    }
    .seat input{ display:none; }

    .seat .seatbtn{
      width: 52px;
      height: 52px;
      border-radius: 16px;
      display:flex;
      align-items:center;
      justify-content:center;
      border: 1px solid rgba(11,27,43,.14);
      background: rgba(26,163,255,.14);
      box-shadow: 0 10px 20px rgba(11,27,43,.08);
      transition: transform .06s ease, background .14s ease, border-color .14s ease, box-shadow .14s ease, opacity .14s ease;
      position: relative;
    }
    .seat:hover .seatbtn{ transform: translateY(-1px); }

    /* seat id tiny label */
    .seat .sid{
      position:absolute;
      bottom:-16px;
      left:50%;
      transform: translateX(-50%);
      font-size: 11px;
      font-weight: 900;
      color: rgba(11,27,43,.55);
      white-space: nowrap;
    }

    /* Selected */
    .seat.checked .seatbtn{
      background: rgba(26,163,255,.92);
      border-color: rgba(26,163,255,.92);
      box-shadow: 0 14px 26px rgba(26,163,255,.18);
    }
    .seat.checked svg *{ stroke: white !important; fill: rgba(255,255,255,.25) !important; }

    /* Locked */
    .seat.locked{ cursor:not-allowed; }
    .seat.locked .seatbtn{
      background: rgba(11,27,43,.10);
      border-color: rgba(11,27,43,.12);
      box-shadow:none;
      opacity: .55;
    }
    .seat.locked svg *{ stroke: rgba(11,27,43,.45) !important; fill: rgba(11,27,43,.08) !important; }

    /* ====== Cabin header (Business/Economy) ====== */
    .cabin-banner{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 12px 14px;
      border-radius: 18px;
      border: 1px solid rgba(11,27,43,.10);
      background: rgba(26,163,255,.06);
      margin: 8px 8px 12px;
    }
    .cabin-left{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight: 950;
      color: rgba(11,27,43,.86);
    }
    .cabin-pill{
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 950;
      border: 1px solid rgba(11,27,43,.10);
      background: rgba(255,255,255,.75);
      color: rgba(11,27,43,.70);
    }
    .cabin-rule{
      height: 10px;
      flex:1;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(26,163,255,.65), rgba(26,163,255,.12));
      border: 1px solid rgba(26,163,255,.20);
    }
    .cabin-ico{
      width: 34px;
      height: 34px;
      border-radius: 14px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(26,163,255,.12);
      border: 1px solid rgba(26,163,255,.20);
    }

    /* Mobile */
    @media (max-width: 720px){
      .cols{ grid-template-columns: 44px 46px 46px 34px 46px 46px; gap:8px; }
      .row{ grid-template-columns: 34px 46px 46px 34px 46px 46px; gap:8px; }
      .seat .seatbtn{ width:46px; height:46px; border-radius: 14px; }
      .aisle{ height:46px; border-radius: 14px; }
    }
  </style>
</head>

<body>
  {% include "topbar.html" %}

  <main class="hero">
    <section class="hero-card hero-card--wide">

      <h1>Select Seats</h1>
      <p class="subtitle">Please select exactly <b>{{ needed }}</b> seats.</p>

      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, msg in messages %}
            <div class="alert {{ category }}">{{ msg }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <div class="seatmap-shell">
        <div class="seatmap-top">
          <h3>Seat Map</h3>
          <div class="legend">
            <span class="lg"><span class="swatch free"></span>Available</span>
            <span class="lg"><span class="swatch sel"></span>Selected</span>
            <span class="lg"><span class="swatch lock"></span>Taken</span>
          </div>
        </div>

        <div class="plane">

          <!-- Cabin banner: Python already filters seats by class, so show one cabin -->
          <div class="cabin-banner">
            <div class="cabin-left">
              <span class="cabin-ico" aria-hidden="true">✈️</span>
              <span>{{ cabin_title if cabin_title is defined else "Cabin" }}</span>
              <span class="cabin-pill">{{ cabin_subtitle if cabin_subtitle is defined else "" }}</span>
            </div>
            <div class="cabin-rule" aria-hidden="true"></div>
          </div>

          <!-- Column letters -->
          <div class="cols">
            <div class="spacer">#</div>
            <div>A</div>
            <div>B</div>
            <div class="aisle-head">AISLE</div>
            <div>C</div>
            <div>D</div>
          </div>

          <form method="POST">
            <div class="rows">

              {# Build seat_map row -> col -> seat #}
              {% set seat_map = {} %}
              {% for s in seats %}
                {% set r = s.Row_Num %}
                {% set c = s.Column_Number %}
                {% if seat_map.get(r) is none %}
                  {% set _ = seat_map.update({r: {}}) %}
                {% endif %}
                {% set _ = seat_map[r].update({c: s}) %}
              {% endfor %}

              {% for row_num in seat_map.keys()|sort %}
                <div class="row">
                  <div class="row-num">{{ row_num }}</div>

                  {% for col in ['A','B'] %}
                    {% set has = seat_map[row_num].get(col) %}
                    {% if has %}
                      {% set seat_id = (row_num|string) + col %}
                      {% set is_locked = (seat_id in occupied) %}
                      {% set is_checked = (seat_id in selected) %}
                      <label class="seat {{ 'locked' if is_locked else '' }} {{ 'checked' if is_checked else '' }}">
                        <input type="checkbox"
                               name="seat_choice"
                               value="{{ seat_id }}"
                               {% if is_checked %}checked{% endif %}
                               {% if is_locked %}disabled{% endif %}>

                        <div class="seatbtn" title="{{ seat_id }}">
                          <!-- Seat icon (SVG) -->
                          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                            <path d="M7 3h4a2 2 0 0 1 2 2v8H7V3Z" stroke="rgba(11,27,43,.78)" stroke-width="1.6" />
                            <path d="M13 7h3a2 2 0 0 1 2 2v4h-5V7Z" stroke="rgba(11,27,43,.78)" stroke-width="1.6" />
                            <path d="M6.5 13h12a1.5 1.5 0 0 1 1.5 1.5V16a3 3 0 0 1-3 3H8a3 3 0 0 1-3-3v-2.5A.5.5 0 0 1 5.5 13Z"
                                  fill="rgba(26,163,255,.10)" stroke="rgba(11,27,43,.65)" stroke-width="1.3"/>
                          </svg>
                          <span class="sid">{{ seat_id }}</span>
                        </div>
                      </label>
                    {% else %}
                      <div></div>
                    {% endif %}
                  {% endfor %}

                  <div class="aisle" title="Aisle"></div>

                  {% for col in ['C','D'] %}
                    {% set has = seat_map[row_num].get(col) %}
                    {% if has %}
                      {% set seat_id = (row_num|string) + col %}
                      {% set is_locked = (seat_id in occupied) %}
                      {% set is_checked = (seat_id in selected) %}
                      <label class="seat {{ 'locked' if is_locked else '' }} {{ 'checked' if is_checked else '' }}">
                        <input type="checkbox"
                               name="seat_choice"
                               value="{{ seat_id }}"
                               {% if is_checked %}checked{% endif %}
                               {% if is_locked %}disabled{% endif %}>

                        <div class="seatbtn" title="{{ seat_id }}">
                          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                            <path d="M7 3h4a2 2 0 0 1 2 2v8H7V3Z" stroke="rgba(11,27,43,.78)" stroke-width="1.6" />
                            <path d="M13 7h3a2 2 0 0 1 2 2v4h-5V7Z" stroke="rgba(11,27,43,.78)" stroke-width="1.6" />
                            <path d="M6.5 13h12a1.5 1.5 0 0 1 1.5 1.5V16a3 3 0 0 1-3 3H8a3 3 0 0 1-3-3v-2.5A.5.5 0 0 1 5.5 13Z"
                                  fill="rgba(26,163,255,.10)" stroke="rgba(11,27,43,.65)" stroke-width="1.3"/>
                          </svg>
                          <span class="sid">{{ seat_id }}</span>
                        </div>
                      </label>
                    {% else %}
                      <div></div>
                    {% endif %}
                  {% endfor %}
                </div>
              {% endfor %}

            </div>

            <div class="cta-row cta-row--below" style="justify-content: flex-end;">
              <button type="submit" class="btn btn-primary" style="border: none; cursor: pointer;">
                Continue
              </button>
              <a class="btn btn-secondary" href="{{ url_for('home_page') }}">
                Cancel
              </a>
            </div>
          </form>

        </div>

        <div class="hint">
          Tip: taken seats are disabled. You must pick exactly {{ needed }} seats.
        </div>
      </div>

    </section>
  </main>

  <script>
    // Toggle selected styling on click (instant UI)
    document.querySelectorAll('.seat input[type="checkbox"]').forEach(cb => {
      cb.addEventListener('change', (e) => {
        const label = e.target.closest('.seat');
        if (!label) return;
        if (e.target.checked) label.classList.add('checked');
        else label.classList.remove('checked');
      });
    });
  </script>

</body>
</html>
